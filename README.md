# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ1

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
–ü–µ—Ä–µ–∫–ª—é—á–∏–ª nginx –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç 5080, –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –¥–µ–º–æ–Ω–∞. –°–æ–±—Ä–∞–ª –ª–æ–≥–∏ –∏ –ø–µ—Ä–µ–¥–∞–ª –∫–æ–º–º–∞–Ω–¥–µ sealert, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥–∞.
```
sealert -a /tmp/1.log
```
–í—ã–ø–æ–ª–Ω–∏–º –∫–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ø–æ—Ä—è–¥–∫—É
### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞ –≤ –∏–º–µ—é—â–∏–π—Å—è —Ç–∏–ø
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–∫–∏ –ø–æ–ª–∏—Ç–∏–∫ SELinux.
port - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ—Ä—Ç–∞
-a - –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å
-t - —É–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞
-p - —É–∫–∞–∑–∞—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∏ –ø–æ—Ä—Ç
```
[root@nginx ~]# semanage port -a -t http_port_t -p tcp 5080
```
### 2. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ setsebool
–£—Ç–∏–ª–∏—Ç–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏. –í–∫–ª—é—á–∞–µ–º –æ–ø—Ü–∏—é nis_enabled. –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø—Ü–∏–∏ (Allow system to run with NIS)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏:
-P - –∏–∑–º–µ–Ω—è–µ—Ç –æ–ø—Ü–∏–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏, –Ω–æ –∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –¢–∞–∫ —á—Ç–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è.
```
[root@nginx ~]# setsebool -P nis_enabled 1
```
### 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª—è SELinux
–£—Ç–∏–ª–∏—Ç–∞ ausearch –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥ –¥–µ–º–æ–Ω–∞ audit.
-c - —É–∫–∞–∑—ã–≤–∞–µ–º —Å –∫–∞–∫–∏–º –∏–º–µ–Ω–µ–º –∏—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–µ
-raw - –Ω–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–π —É—Ç–∏–ª–∏—Ç–µ
–£—Ç–∏–ª–∏—Ç–∞ audit2allow - —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
-M - —Å–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ –º–æ–¥—É–ª—å
```
[root@nginx ~]# ausearch -c 'nginx' --raw | audit2allow -M my-nginx
[root@nginx ~]# semodule -i my-nginx.pp
```


# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ2

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

–¢–∞–∫ –∂–µ –∫–∞–∫ –∏ –≤ –ø–µ—Ä–≤–æ–º –∑–∞–¥–∞–Ω–∏–∏ –ø–æ–ª—É—á–∏–ª –ø—Ä–∏–º–µ—Ä—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É sealert
```
[root@ns01 ~]# sealert -a /tmp/1.log
```
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞, –Ω–∞—à–µ–ª –∫–∞–∫–æ–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–≤–∞–ª—Å—è. –õ—é–±–æ–π –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Ç–∏–ª–∏—Ç—ã sealert –ø–æ–¥–æ—à–µ–ª, –±—ã. –ù–æ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫–æ–π –∏–∑ –Ω–∏—Ö –ª—É—á—à–µ –ø–æ–¥–æ–π–¥–µ—Ç.  
–ù–∞—à–µ–ª –∫–∞—Ç–∞–ª–æ–≥ /var/named/dynamic/. –ò –ø–æ—Å–º–æ—Ç—Ä–µ–ª –µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç–∏–ø, named_cache_t.
–í—ã–ø–æ–ª–Ω–∏–ª –∫–æ–º–º–∞–Ω–¥—É semanage
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–∫–∏ –ø–æ–ª–∏—Ç–∏–∫ SELinux.
fcontext - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
-a - –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å
-t - —É–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞, –∏ –¥–∞–ª–µ–µ —É–∫–∞–∑—ã–≤–∞–µ–º —à–∞–±–ª–æ–Ω
```
[root@ns01 ~]# semanage fcontext -a -t named_cache_t '/etc/named/dynamic(/.*)?'
```

## –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–æ—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–± —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
–°–æ–∑–¥–∞–µ–º –Ω–∞—à –º–æ–¥—É–ª—å. –ü–æ—Å–º–æ—Ç—Ä–∏–º –∏—Å—Ö–æ–¥–Ω–∏–∫ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è.
```
[root@ns01 ~]# audit2allow -M named_add --debug < /tmp/1.log
[root@ns01 ~]# cat named_add.te

module named_add 1.0;

require {
        type etc_t;
        type named_t;
        class file create;
}

#============= named_t ==============

#!!!! WARNING: 'etc_t' is a base type.
allow named_t etc_t:file create;
[root@ns01 ~]# semodule -i named_add.pp
```
–ï—Å–ª–∏ —è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª —Ç–æ –º—ã –¥–∞–¥–∏–º –¥–æ—Å—Ç—É–ø named —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å —Ç–∏–ø etc_t, –∏ —Ç—É—Ç –≤ –º–æ–¥—É–ª–µ –Ω–∞—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—Ç —á—Ç–æ —ç—Ç–æ –±–∞–∑–æ–≤—ã–π —Ç–∏–ø.  
–ï—Å–ª–∏ –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞—Ç–∞–ª–æ–≥ /etc (—É–∫–∞–∑–∞–ª —É—Å–µ—á–µ–Ω—ã–π –≤—ã–≤–æ–¥), —Ç–æ –º—ã —É–±–µ–¥–∏–º—Å—è —á—Ç–æ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ —Å —Ç–∏–ø–æ–º etc_t.
–ï—Å–ª–∏ named –≤–∑–ª–æ–º–∞—é—Ç —Ç–æ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è, –Ω–µ –Ω–∞—à –≤–∞—Ä–∏–∞–Ω—Ç.
–ê –≤–æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç.

üìö–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ/–ø—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ(-–Ω–∞) –¥–ª—è –∫—É—Ä—Å–∞ ["Administrator Linux. Professional"](https://otus.ru/lessons/linux-professional/)